@page "/skill"
@page "/skill/index"

@inject ISkillService _skillServiceSimple
@using Team12.Data
@using DocumentFormat.OpenXml.Office2010.Excel
@inject DatabaseUtils _databaseUtils

<h3>Skills und deren Typen</h3>

@{      //zum Überprüfen, ob Tabelle in DB vorhanden. Oben angelegt, da nach dem code durchlaufen es keinen sinn mehr machen würde.
        
    _databaseUtils.CreatingEmptyTable();
}   

<table class="table align-middle">
    <thead>
    <tr>
        <th scope="col">Skillname</th>
        <th scope="col">Skilltyp</th>
        <th scope="col">
            <a href="/skill/edit">
                <button type="button" class="btn btn-primary">Add</button>
            </a>
        </th>
    </tr>
    </thead>
    <tbody>
    @if (_skillServiceSimple.GetAllSkills().Any()) //Fehler rausgehauen -> kein Element in der List | .any() aus der SoPro Übung am Freitag 
    {
        foreach (Skill skill in _skillServiceSimple.GetAllSkills())
        {
            <tr>
                <td>@skill.Name</td>
                <td>@skill.type</td>
                <td>
                    <a href="/skill/edit/@skill.ID">
                        <button type="button" class="btn btn-secondary">Edit/Update</button>
                    </a>
                </td>
                <td>
                    <button @onclick="() => DeleteSkill(skill.ID)" type="button" class="btn btn-danger">Delete</button>
                </td>
            </tr>
        }
    } //Layout der Seite aus mdbootstrap.com + button layout aus buttons-bootstrapv5.0 ^^
    else
    {
        LoadJson();
    }
    </tbody>
</table>

@code{
    
    public int ID { get; set; }

    public string name { get; set; }
    public Skilltype type { get; set; }
    
    public DatabaseJson _dbJ { get; set; } = new DatabaseJson();
    
    //laden von jsondateien als skills in die sonst leere tabelle theoretically
    public void LoadJson()
    {
        List<string> list = _dbJ.LoadJsonSkills();
        
        foreach (var element in list)
        {
            _skillServiceSimple.UpdateSkill((new Skill() {ID = ID, Name = (string) element, type = Skilltype.Hardskill}));
        }                                                                           
    }                                                                               
    private void DeleteSkill(int id)
    {
        _skillServiceSimple.DeleteSkill(id);
    }
    

}