@page "/Projektübersicht/Projektedit"
@page "/Projektübersicht/Projektedit/{ID:int}"

@using AVATI.Data
@using Blazorise
@inject IProjektService _projectService
@inject NavigationManager _navigationManager
@inject ProjectServiceSimple _projectServiceSimple

<AddFieldToProject @ref="_addFieldToProject"/>

<h3>Edit Projekt</h3>

<EditForm Model="@_project" OnInvalidSubmit="@Save">
    <DataAnnotationsValidator/>

    <div class="column">
        <div class="form-group row">
            <label class="col-sm-2 col-form-label" value="@_project.Projecttitel">Projekttitel</label>
            <div class="col-sm-10">
                <InputText id="projekttitel" class="form-control" @bind-Value="_project.Projecttitel"></InputText>
            </div>
        </div>


        <div class="form-group row">
            <label class="col-sm-2 col-form-label ">Projektbeschreibung</label>
            <div class="col-sm-10">
                <textarea id="projektbeschreibung" class="form-control" rows="3" @bind="_project.Projectdescription"></textarea>
            </div>
        </div>


        <div class="form-group row">
            <label class="col-sm-2 col-form-label">Branchen</label>
            <div class="col-sm-8 col-form-label">
                <div class="row col">
                    <input class="form-control col-8" type="text" value="@String.Join(" | ", _projectServiceSimple.GetAllFieldsFromOneProject(ID).ToArray())" placeholder="" readonly/>
                    <div>
                        <button class="btn btn-info mb-3" @onclick="() => PopAddFieldToProject()">Add Branchen</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row">
                <label class="col-sm-2 col-form-label">Projektanfang</label>
                <div class="col-sm col-form-label">
                    <div class="row">
                        <input class="center col-2" type="date" value=@_project.Projectbeginning/>
                    </div>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-2 col-form-label">Projektende</label>
                <div class="col-sm col-form-label">
                    <div class="row">
                        <input class="center col-2" type="date" value=@_project.Projectend/>
                    </div>
                </div>
            </div>
        </div>


        <div class="form-group row">
            <label class="col-sm-2 col-form-label">Mitarbeiter</label>
            <div class="col-sm-2 col-form-label">
                <!--                     brauch hier die employee klasse                                  -->
            </div>
        </div>


    </div>
    <div class="container">
        <a href="/Projektübersicht" class="col-sm-8 col-form-label">
            <button type="button" class="btn btn-success" @onclick="(() => { Save(); })">Submit</button>
        </a>
        <a href="/Projektübersicht" class="col-sm-8 col-form-label">
            <button type="button" class="btn btn-danger">Cancel</button>
        </a>
    </div>
</EditForm>


@code {
    private Project _project { get; set; } = new Project();
    AddFieldToProject _addFieldToProject;

    [Parameter]
    public int ID { get; set; }

    public DateTime time { get; set; }
    public string field { get; set; }


    private void Save()
    {
        _projectService.UpdateProject(_project);
        _navigationManager.NavigateTo("/Projektübersicht");
    }

    public void PopAddFieldToProject()
    {
        _addFieldToProject.Showing();
    }

}